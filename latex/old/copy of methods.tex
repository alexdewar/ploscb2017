\input{head}

\section{Methods}
\subsection{Processing the receptive fields}
\label{sec:methods:preprocessing}

Here, as throughout, Matlab\textregistered\ (MathWorks, Natick, MA, USA) was used to perform all calculations.

The \ac{RF} data were drawn from \citeA{seelig2013feature} (Extended Data Figure 8), which comprised measurements from 7 R2 glomeruli and 14 R4d glomeruli in the lateral triangle; the precise number of flies included varied by glomerulus ($2\le N\le 7$).
The data were in the form of images, with red areas for excitatory regions and blue for inhibitory.
Each point on the image was assigned a value ranging from --1 to 1, for maximally inhibitory and maximally excitatory, respectively.
These values were then thresholded:
$$
g_{i,j} = [I_{i,j} \ge \Theta] - [I_{i,j} \le -\Theta]
%g_{i,j} = \frac{1}{2} ( [I_{i,j} \ge \Theta] - [I_{i,j} \le -\Theta] + 1 )
$$
where $g_{i,j}$ is the $i,j$th pixel of the thresholded kernel, $I_{i,j}$ is the $i,j$th value of the processed receptive field image and $\Theta$ is the threshold value, here $0.25$.

The centroid for the largest excitatory region, at coordinates $(x,y)$, is calculated using Matlab's \texttt{regionprops} function on an image with values of 1 for positive values and 0 otherwise.
The average centroid, $(\bar{x},\bar{y})$, across flies is also calculated, and the kernels are recentered to these coordinates:
$$
g_{i,j} := \left\{ \begin{array}{ll} g_{i+y-\bar{y},j+x-\bar{x}} & \mbox{for } \bar{y}-y \le i \le \bar{y}-y+m ;\\
0 & \mbox{otherwise.} \end{array} \right.
$$

The average \ac{RF} values, $\bar{g}_{i,j}$, are then calculated across flies.
The averaged \ac{RF} is then divided into two matrices representing the excitatory and inhibitory regions, which are thresholded again:
\begin{align*}
\bar{g}_{i,j} &= \frac{\sum\limits_{g \in \bm{G}} g_{i,j}}{|\bm{G}|} \\
X_{i,j} &= [\bar{g}_{i,j} \ge \Theta] \\
Y_{i,j} &= [\bar{g}_{i,j} \le -\Theta]
\end{align*}
where $\bm{G}$ is the set of kernels being averaged, $\Theta$ is the threshold (again: 0.25), $X$ is the excitatory matrix and $Y$ the inhibitory matrix.

In order to calculate the activation for a given \ac{RF} on presentation of an image stimulus, $I$, the \ac{RF} first must be resized to the same size as the image.
This is accomplished by first resizing $X$ and $Y$ separately with Matlab's \texttt{imresize} function to the same dimentions as $I$.
Finally, the matrices are recombined and the excitatory and inhibitory regions are assigned different values:
$$
K_{i,j} = \left\{
\begin{array}{rl}
\left( \sum\limits^m_{i=1}\sum\limits^n_{j=1}X_{i,j} \right)^{-1}, & \mbox{for } X_{i,j} = 1; \\
-\left( \sum\limits^m_{i=1}\sum\limits^n_{j=1}Y_{i,j} \right)^{-1}, & \mbox{for } Y_{i,j} = 1; \\
0, & \mbox{otherwise.}
\end{array}
\right.
$$
Thus, $\sum\limits_{i=1}^m \sum\limits_{j=1}^n K_{i,j}=1$.

\begin{comment}
The total numbers of excitatory, $N_{\mathrm{exc}}$, and inhibitory values, $N_{\mathrm{inh}}$, for the average kernel are then calculated:
\begin{align*}
N_{\mathrm{exc}} &= \sum\limits_{i=1}^m \sum\limits_{j=1}^n [K_{i,j} = 1] \\
N_{\mathrm{inh}} &= \sum\limits_{i=1}^m \sum\limits_{j=1}^n [K_{i,j} = -1]
\end{align*}
\end{comment}

The activation of an average kernel, $K$, to the presentation of an image stimulus, $I$, is then:
$$
\begin{array}{rl}
A(I,K) = {\sum\limits^m_{i=1} \sum\limits^n_{j=1} I_{i,j}K_{i,j}}, &\mathrm{for\ } 0 \le I_{i,j} \le 1
\end{array}
$$
where $I_{i,j}$ and $K_{i,j}$ are the $i,j$th pixel of the image and kernel, respectively. %This means for an image where every pixel $I_{i,j}=1$ or $I_{i,j}=0$, $A(I,K) = 1$.

\include{fig_averagekern}

\subsection{Can we replicate behavioral experiments?}

\subsubsection{Population activity}
\include{tab_patterns}

\subsubsection{Could these neurons discriminate visual patterns?}

\subsubsection{Rotational image difference function}
Here we have used a modified version of the \ac{RIDF} \cite{Philippides2011,Zeil2003}.
$$
r(I,J,\bm{G},\theta) = \frac{1}{|\bm{G}|\cdot mn} {\sum\limits_{K \in \bm{G}} \sum\limits^n_{i=1} \sum\limits^m_{j=1} (I_{i,j}-J_{i,j})^2 \cdot {K_{i,j}}(\theta)^2}
$$

\include{fig_recap}

\subsection{What information is preserved in these neurons?}
Neural networks were used as a means of testing what properties of a visual stimulus can be encoded in a simple network.
The neural networks for this section were implemented using the \texttt{Netlab} toolbox for Matlab \cite{netlab}.
Two-layer feedforward networks with 10 hidden units, optimised with the scaled conjugate gradient function, were used throughout.

The stimuli with which the networks were trained were a series of black `blobs' on a white background.
The blobs were based on ellipses with a fixed ratio between the lengths of the major and minor axes, with the radii modified with complex waves:
$$
r \le \left(\frac{\cos^2 \theta}{2} + \frac{\sin^2 \theta}{a} \right)^{-1} + W(\theta)
$$
where $a$ is the length of the major axis and $W(\theta)$ is a complex wave defined as:
$$
W(\theta) = \sum_{i=1}^n W_i(\theta) = \sum_{i=1}^n A_i \sin f_i (\theta+\phi_i) 
$$
where $A_i$, $f_i$ and $\phi_i$ describe the maximum amplitude, frequency and phase shift of the wave $W_i(\theta)$, respectively.

\subsubsection{Can networks extract stimulus position?}


\bibliography{library}
\bibliographystyle{apacite}

\end{document}
